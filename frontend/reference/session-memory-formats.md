# Session and Memory Formats

This page documents file formats generated by runtime persistence modules.

## Session

Path:

- `workspace/sessions/session-<YYYYMMDD-HHMMSS>.md`

Header template:

```md
# OpenPocket Session

- id: <YYYYMMDD-HHMMSS>
- started_at: <ISO8601>
- model_profile: <profile_key>
- model_name: <model_name>

## Task

<task text>

## Steps
```

Per-step block template:

````md
### Step N

- at: <ISO8601>
- thought:
```text
<thought or (empty)>
```
- action:
```json
<action json>
```
- execution_result:
```text
<result text>
```
````

For human-auth steps, `execution_result` may include:

```text
Human auth approved|rejected|timeout request_id=<id> message=<summary>
human_artifact=<absolute path, optional>
delegation_result=<runtime apply summary, optional>
delegation_template=<next-step UI template hint, optional>
local_screenshot=<absolute path, optional>
```

Final block template:

```md
## Final

- status: SUCCESS|FAILED
- ended_at: <ISO8601>

### Message

<final message>
```

## Daily Memory

Path:

- `workspace/memory/YYYY-MM-DD.md`

Created on first write with:

```md
# Memory YYYY-MM-DD
```

Append format:

```text
- [HH:MM:SS] [OK|FAIL] [<modelProfile>] task: <task> | result: <compact_message>
```

`compact_message` is whitespace-normalized and truncated to 400 chars.

## Screenshot Format

Saved file path format:

```text
<screenshots.directory>/<YYYYMMDD-HHMMSS>-session-<sessionId>-step-<NNN>-<safeCurrentApp>.png
```

Notes:

- `safeCurrentApp` keeps only `[a-zA-Z0-9._-]`, others become `_`
- screenshot store enforces retention by deleting oldest PNG files beyond maxCount

## Script Artifact

Path per run:

```text
workspace/scripts/runs/run-<runId>/
```

Files:

- `script.sh`
- `stdout.log`
- `stderr.log`
- `result.json`

`result.json` shape:

```json
{
  "ok": true,
  "runId": "20260218-130000-ab12cd",
  "runDir": "...",
  "scriptPath": ".../script.sh",
  "exitCode": 0,
  "timedOut": false,
  "durationMs": 432,
  "stdout": "...",
  "stderr": "..."
}
```

## Human Auth Artifact

When remote approval uploads an artifact (for example a camera snapshot), bridge stores it under:

```text
state/human-auth-artifacts/<requestId>.<ext>
```

Extension mapping is inferred from mime type:

- `image/png` -> `.png`
- `image/jpeg` -> `.jpg`
- `image/webp` -> `.webp`
- `application/json` -> `.json`
- unknown -> `.bin`

Common JSON payload shapes:

```json
{ "kind": "text", "value": "123456", "capability": "2fa", "capturedAt": "..." }
```

```json
{ "kind": "qr_text", "value": "otpauth://...", "capability": "qr", "capturedAt": "..." }
```

```json
{ "kind": "geo", "lat": 37.7749, "lon": -122.4194, "capability": "location", "capturedAt": "..." }
```
